---
layout:     post                   
title:      深入理解计算机系统             
subtitle:   计算机系统漫游
date:       2018-03-19            
author:     Hearnseu                      
header-img: img/post-bg-2015.jpg    
catalog: true                       
tags:                              
    - 计算机系统
---


## 1.1 信息就是位（bit）+上下文
由125个ASCII字符构成的文件称为文本文件，其他文件都称为二进制文件。8bit为一个字节，4个字节为一个字（word）。
所有的信息都有一串位表示，在不同的上下文中，一个同样的字节序列可能表示为一个整数，浮点数，字符串或者机器指令等。

## 1.2 程序被其他程序翻译成不同的格式
如C语言程序被转化为低级*机器语言指令*，按照*可执行目标程序*的格式打包，并以二进制磁盘文件的形式存放起来。
`$ gcc -o hello hello.c`
以上指令把它翻译成一个可执行目标文件，可以分为四个阶段，执行四个阶段的程序：预处理、编译器、汇编器和链接器一起构成了编译系统（compilation system）。

- *预处理阶段*。.c -> .i 文件。
- *编译阶段*。 .i -> .s 文件，它包含了*汇编语言程序*，其语句以标准的文本格式描述了一条低级机器语言指令，它**为不同高级语言的不同编译器提供了通用的输出语言**。C和Fortran语言输出的都是一样的汇编语言。
- *汇编阶段*。 .s -> .o 文件。 汇编器（as）翻译为机器语言指令，打包为relocatable object program 格式，保存在目标文件.o中。
- *链接阶段*。 链接器（ld）负责合并调用的库函数，生成可执行目标文件。

## 1.3 了解编译系统如何工作是大有益处的
- 优化程序性能。 为什么将循环求和的结果保存在本地变量中，比放在通过引用传递过来的参数中，运行速度要快很多？ 需要了解编译器的工作方式。
- 理解链接时出现的错误。 静态变量与全局变量的区别？动态库与静态库的区别？
- 避免安全漏洞。 堆栈原理与缓冲区溢出错误。

## 1.4 处理器读取存储器中的指令
### 1.4.1 系统的硬件组成
1. **总线**。贯穿整个系统的一组电子管道，通常设计为传送定长的字节块，如4个字节（32位），8个字节（64位）。
2. **I/0设备**。 每个I/O设备通过控制器或适配器与I/O总线相连。
3. **主存**。 临时存储设备，DRAM。
4. **处理器**。 解释或执行主存中的指令，核心是一个32位的寄存器或称程序计数器(PC)，指向主存中的某条机器指令。处理器从PC指向的存储器中读取指令，解释指令的bit，执行该指令指示的简单操作，更新PC, 使其指向下一条指令。这样的操作围绕着主存、寄存器文件和算术逻辑单元（ALU）进行。每个寄存器都有唯一的名字。操作内容举例如下：
    - 加载。 把一个字节或一个字从主存复制到寄存器，覆盖原来内容
    - 存储。 加载的反向操作。
    - 操作。 把两个寄存器的内容复制到ALU，ALU进行算术操作后将结果存放到一个寄存器中，覆盖原有内容
    - 跳转。 从指令中抽取一个字，复制到PC中，覆盖原值。
    
## 1.5 高速缓存至关重要
不同存储设备读写速度相差甚大。处理器与主存之间的速度差也在加大，因此在处理器添加高速缓存，用来存放处理器近期可能会需要的信息。利用了**局部性原理，即程序具有访问局部区域里的数据和代码的趋势**。通过让高速缓存存放可能经常访问的数据，大部分存储器操作能在高速缓存中进行。

## 1.7 操作系统管理硬件
操作系统有两个基本功能：1 防止硬件被失控的应用程序滥用， 2 向应用程序提供简单一致的机制来控制复杂而有通常大相庭径的低级硬件设备。操作系统通过几个基本的抽象概念（进程，虚拟存储器和文件）来实现这两个功能。虚拟存储器包含了主存和文件抽象的I/O设备。

> Unix和POSIX 
>  贝尔实验室发明Unix系统，并向学校提供源代码，加州大学伯克利分校在一系列发布版本中添加了虚拟存储器和Internet协议，称为Unix 4.xBSD。不同的Unix厂商开发了不兼容的特性，IEEE为了标准化开发Unix，制定了POSIX标准。

### 1.7.1 进程
进程是操作系统对一个正在运行的程序的一种抽象。操作系统为了让处理器并发执行多个进程，让处理器在进程间切换，这种交错执行的机制称为**上下文切换**。
操作系统保持跟踪进程运行所需的所有状态信息，就是*上下文*， 包括了PC和寄存器文件的当前值，主存的内容等。从当前进程转移到某个新进程时，会保存当前进行的上下文，恢复新进程的上下文，然后将控制权传递到新进程，后者就会从上次停止的地方开始。

### 1.7.2 线程
一个进程可以由多个称为线程的执行单元组成。每个线程运行在进程的上下文中，并共享同样的代码和全局数据。

### 1.7.3 虚拟存储器
一个抽象概念，为每个进程提供了一个假象，即每个进程都在独占的使用主存。每个进程看到的一致的存储器，称为*虚拟地址空间*。

在Linux中， 地址空间最上面的区域为操作系统中的代码和数据，对所有进程都一样。底部区域存放用户进程的代码和数据。虚拟地址空间的地址从下往上增大，也就是用户进程是低地址，然后是堆，继续往上增加，然后是共享库的映射区域，然后是栈，最高地址是内核虚拟存储器。

- 程序代码和数据。 对所有进程，代码从同一固定地址开始，紧接着是和C全局变量对应的数据位置。代码和数据区是直接按照可执行文件的内容初始化的。
- 堆。 可读写数据后便是运行时堆，堆在运行时可以动态扩展和收缩。
- 共享库。 存放C标准库和数学库等代码和数据的区域。
- 栈。 用户栈，编译器用它实现函数调用，调用一个函数，栈会增长，从一个函数返回，栈会收缩。
- 内核虚拟存储器。 内核总是驻留在内存中，是操作系统的一部分。不运行应用程序读写调用这个区域的内容或函数。

### 1.7.4 文件
文件就是字节序列，仅此而已。每个I/O设备，甚至网络，都可视为文件。


## 1.9 重要主题
### 1.9.1 并发与并行
并发concurrency， 一个同时具有多个活动的系统
并行parallelism， 用并发使系统运行更快

1. 线程级并发。分时提供了并发执行的支持。
2. 指令级并行。 处理器同时执行多条指令的属性
3. 单指令，多数据并行。 一条指令产生多个并行执行的操作，如一条并行地对4对float做加法的指令。

### 1.9.2 抽象的重要性
计算机科学中的重要概念。
在处理器里，指令级结构提供了对实际处理器硬件的抽象，只要执行模型一样，不同的处理器实现也能执行同样的机器代码。
虚拟机提供了对整个计算机的抽象。



 


